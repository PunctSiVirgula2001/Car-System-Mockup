#pragma once
/*
 * OLED Driver Config - Header
 * Purpose: Compile-time configuration for the OLED device (I2C address, width/height, rotation, timings).
 * Notes: Keep device-specific constants here; no code. Pins belong in board_pins.h.
 * Usage: Included indirectly via project_config.h in oled_i2c.c.
 */

#include <string.h>
#include "hal_i2c.h"

/* OLED I2C Address */
#define OLED_I2C_ADDRESS    (0x3CU)

/* OLED Dimensions */
#define OLED_WIDTH_PIXELS   (128U)
#define OLED_HEIGHT_PIXELS  (64U)

/* OLED Command/Parameter Bit Width */
#define OLED_CMD_PARAM_BITS (8U)

/* OLED FONT */
#define OLED_FONT_WIDTH      (5U)
#define OLED_FONT_HEIGHT     (7U)
#define OLED_FONT_SPACING_X  (1U)
#define OLED_TEXT_PIXEL_WIDTH_FROM_LEN(len_chars) ((int)(((len_chars) == 0U) ? 0 : ((len_chars) * OLED_FONT_WIDTH) + (((len_chars) - 1U) * OLED_FONT_SPACING_X)))
#define OLED_TEXT_PIXEL_WIDTH(string)                (OLED_TEXT_PIXEL_WIDTH_FROM_LEN(strlen(string)))

/* Debug screen layout positions (in pixels) */
typedef enum
{
    /* Headers */
    OLED_SEPARATOR_POS_X       = (OLED_WIDTH_PIXELS / 2U) - 20U,

    OLED_CONFIG_HEADER_POS_X   = 2U,
    OLED_CONFIG_HEADER_POS_Y   = 0U,

    OLED_DEBUG_HEADER_POS_X    = OLED_SEPARATOR_POS_X + 4U,
    OLED_DEBUG_HEADER_POS_Y    = 0U,

    OLED_HEADER_LINE_Y         = OLED_FONT_HEIGHT + 1U,
    
    /* Text start positions */
    OLED_CONFIG_TEXT_START_X   = OLED_CONFIG_HEADER_POS_X,
    OLED_CONFIG_TEXT_START_Y   = OLED_HEADER_LINE_Y + 2U,

    OLED_DEBUG_TEXT_START_X    = OLED_DEBUG_HEADER_POS_X,
    OLED_DEBUG_TEXT_START_Y    = OLED_HEADER_LINE_Y + 2U,

    OLED_GRAPH_BASE_OFFSET_Y   = OLED_FONT_HEIGHT + 2U,

    /* Square graph configs.*/
    OLED_GRAPH_SQUARE_COLUMNS = 16U,
    OLED_GRAPH_SQUARE_ROWS    = 5U,
    OLED_GRAPH_SQUARE_SIZE    = 4U,
    OLED_GRAPH_SQUARE_SPACING = 1U,

    /* Y axis gap between dynamic/static fields */
    OLED_GRAPH_GAP_Y          = 4U
} oled_params_position_t;


/* Option selection */
typedef enum
{
    OLED_CONFIG_OPTION_SPEED = 0U,
    OLED_CONFIG_OPTION_HEADLIGHTS,
    OLED_CONFIG_OPTION_REVERSE,
    OLED_CONFIG_OPTION_NONE
} oled_option_select_t;
/* Glyph structure for font representation and selection. */
typedef struct
{
    char character;                 /* ASCII character */
    uint8_t rows[OLED_FONT_HEIGHT]; /* Bitmap rows for the character */
} oled_glyph_t;

/* Minimal 5x7 font for the characters we need (CONFIG/DEBUG screen). */
static const oled_glyph_t s_oled_glyphs[] = {
    /* Space */
    { ' ', { 0x00, 0x00, 0x00, 0x00, 0x00, 0x00, 0x00 } },
    /* Digits */
    { '0', { 0x0E, 0x11, 0x13, 0x15, 0x19, 0x11, 0x0E } },
    { '1', { 0x04, 0x0C, 0x04, 0x04, 0x04, 0x04, 0x0E } },
    { '2', { 0x0E, 0x11, 0x01, 0x0E, 0x10, 0x10, 0x1F } },
    { '3', { 0x0E, 0x11, 0x01, 0x06, 0x01, 0x11, 0x0E } },
    { '4', { 0x02, 0x06, 0x0A, 0x12, 0x1F, 0x02, 0x02 } },
    { '5', { 0x1F, 0x10, 0x1E, 0x01, 0x01, 0x11, 0x0E } },
    { '6', { 0x06, 0x08, 0x10, 0x1E, 0x11, 0x11, 0x0E } },
    { '7', { 0x1F, 0x01, 0x02, 0x04, 0x08, 0x08, 0x08 } },
    { '8', { 0x0E, 0x11, 0x11, 0x0E, 0x11, 0x11, 0x0E } },
    { '9', { 0x0E, 0x11, 0x11, 0x0F, 0x01, 0x02, 0x0C } },
    /* Punctuation */
    { ':', { 0x00, 0x04, 0x00, 0x00, 0x00, 0x04, 0x00 } },
    { '.', { 0x00, 0x00, 0x00, 0x00, 0x00, 0x04, 0x00 } },
    /* Letters */
    { 'A', { 0x0E, 0x11, 0x11, 0x1F, 0x11, 0x11, 0x11 } },
    { 'B', { 0x1E, 0x11, 0x11, 0x1E, 0x11, 0x11, 0x1E } },
    { 'C', { 0x0E, 0x11, 0x10, 0x10, 0x10, 0x11, 0x0E } },
    { 'D', { 0x1E, 0x11, 0x11, 0x11, 0x11, 0x11, 0x1E } },
    { 'E', { 0x1F, 0x10, 0x10, 0x1E, 0x10, 0x10, 0x1F } },
    { 'F', { 0x1F, 0x10, 0x10, 0x1E, 0x10, 0x10, 0x10 } },
    { 'G', { 0x0E, 0x11, 0x10, 0x13, 0x11, 0x11, 0x0E } },
    { 'H', { 0x11, 0x11, 0x11, 0x1F, 0x11, 0x11, 0x11 } },
    { 'I', { 0x0E, 0x04, 0x04, 0x04, 0x04, 0x04, 0x0E } },
    { 'L', { 0x10, 0x10, 0x10, 0x10, 0x10, 0x10, 0x1F } },
    { 'M', { 0x11, 0x1B, 0x15, 0x15, 0x11, 0x11, 0x11 } },
    { 'N', { 0x11, 0x19, 0x15, 0x13, 0x11, 0x11, 0x11 } },
    { 'O', { 0x0E, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0E } },
    { 'P', { 0x1E, 0x11, 0x11, 0x1E, 0x10, 0x10, 0x10 } },
    { 'R', { 0x0F, 0x11, 0x11, 0x0F, 0x14, 0x12, 0x11 } },
    { 'S', { 0x1E, 0x10, 0x10, 0x0E, 0x01, 0x01, 0x1E } },
    { 'T', { 0x1F, 0x04, 0x04, 0x04, 0x04, 0x04, 0x04 } },
    { 'U', { 0x11, 0x11, 0x11, 0x11, 0x11, 0x11, 0x0E } },
    { 'V', { 0x11, 0x11, 0x11, 0x11, 0x0A, 0x0A, 0x04 } },
};
